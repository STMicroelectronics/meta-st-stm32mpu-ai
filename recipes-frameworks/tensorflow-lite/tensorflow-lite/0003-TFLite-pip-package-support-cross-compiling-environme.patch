From c3d1cad1bb78190a7fbca49d33dfa87a2ba1ca4b Mon Sep 17 00:00:00 2001
From: Vincent Abriou <vincent.abriou@st.com>
Date: Mon, 8 Apr 2019 12:01:16 +0200
Subject: [PATCH 3/4] TFLite pip package: support cross compiling environment

Signed-off-by: Vincent Abriou <vincent.abriou@st.com>
---
 .../lite/tools/pip_package/build_pip_package.sh      |  6 +++++-
 tensorflow/lite/tools/pip_package/setup.py           | 20 ++++++++++++++++++++
 2 files changed, 25 insertions(+), 1 deletion(-)

diff --git a/tensorflow/lite/tools/pip_package/build_pip_package.sh b/tensorflow/lite/tools/pip_package/build_pip_package.sh
index ef9ea54..5dc9ebf 100644
--- a/tensorflow/lite/tools/pip_package/build_pip_package.sh
+++ b/tensorflow/lite/tools/pip_package/build_pip_package.sh
@@ -51,4 +51,8 @@ cp $TFLITE_ROOT/tools/pip_package/MANIFEST.in $BUILD_ROOT
 
 # Build the Pip
 cd $BUILD_ROOT
-python setup.py bdist_wheel
+if [ -n "${TENSORFLOW_TARGET}" ] && [ -n "${TENSORFLOW_TARGET_ARCH}" ]; then
+  python3 setup.py bdist_wheel --plat-name=${TENSORFLOW_TARGET}-${TENSORFLOW_TARGET_ARCH}
+else
+  python3 setup.py bdist_wheel
+fi
diff --git a/tensorflow/lite/tools/pip_package/setup.py b/tensorflow/lite/tools/pip_package/setup.py
index c5141c1..38d3fb3 100644
--- a/tensorflow/lite/tools/pip_package/setup.py
+++ b/tensorflow/lite/tools/pip_package/setup.py
@@ -50,6 +50,26 @@ if TARGET == 'rpi':
   os.environ['CC'] = 'arm-linux-gnueabihf-g++'
 MAKE_CROSS_OPTIONS = ['TARGET=%s' % TARGET]  if TARGET else []
 
+TARGET_ARCH = (
+    os.environ['TENSORFLOW_TARGET_ARCH'] if 'TENSORFLOW_TARGET_ARCH' in os.environ
+    else None)
+MAKE_CROSS_OPTIONS += ['TARGET_ARCH=%s' % TARGET_ARCH]  if TARGET_ARCH else []
+
+CC_PREFIX = (
+    os.environ['TENSORFLOW_CC_PREFIX'] if 'TENSORFLOW_CC_PREFIX' in os.environ
+    else None)
+MAKE_CROSS_OPTIONS += ['CC_PREFIX=%s' % CC_PREFIX]  if CC_PREFIX else []
+
+EXTRA_CXXFLAGS = (
+    os.environ['TENSORFLOW_EXTRA_CXXFLAGS'] if 'TENSORFLOW_EXTRA_CXXFLAGS' in os.environ
+    else None)
+MAKE_CROSS_OPTIONS += ['EXTRA_CXXFLAGS=%s' % EXTRA_CXXFLAGS]  if EXTRA_CXXFLAGS else []
+
+BUILD_WITH_NNAPI = (
+    os.environ['TENSORFLOW_BUILD_WITH_NNAPI'] if 'TENSORFLOW_BUILD_WITH_NNAPI' in os.environ
+    else 'true')
+MAKE_CROSS_OPTIONS += ['BUILD_WITH_NNAPI=%s' % BUILD_WITH_NNAPI]  if BUILD_WITH_NNAPI else []
+
 RELATIVE_MAKE_DIR = os.path.join('tensorflow', 'lite', 'tools', 'make')
 MAKE_DIR = os.path.join(TENSORFLOW_DIR, RELATIVE_MAKE_DIR)
 DOWNLOADS_DIR = os.path.join(MAKE_DIR, 'downloads')
-- 
2.7.4

